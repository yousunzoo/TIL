# 가상 메모리의 이해

## 페이지 교체 알고리즘

### 페이지 교체 정책

* 운영체제가 특정 페이지를 물리 메모리에 올리려 하는데, 물리 메모리가 다 차 있다면?
  * 기존 페이지 중 하나를 물리 메모리에서 저장 매체로 내림(저장)
  * 새로운 페이지를 해당 물리 메모리 공간에 올림

> 어떤 페이지를 물리 메모리에서 저장 매체로 내릴 것인가? -> Page Replacement(Swapping) Algorithm

* 페이지 교체 정책 : 메모리에 올려진 페이지 중 어떤 것을 내리고 어떤 새로운 페이지를 올릴지를 결정하는 규칙



### 페이지 교체 알고리즘 (FIFO)

* FIFO Page Replacement Algorithm
  * 가장 먼저 들어온 페이지를 내림



### 페이지 교체 알고리즘 (OPT)

* 최적 페이지 교체 알고리즘 (OPTimal Replacement Algorithm)
  * 앞으로 가장 오랫동안 사용하지 않을 페이지를 내림
  * 일반 OS에서는 구현 불가



### 페이지 교체 알고리즘 (LRU)

* LRU(Least Recently Used) Page Replacement Algorithm
  * 가장 오래 전에 사용된 페이지를 교체
  * OPT 교체 알고리즘 구현이 불가하므로, 과거 기록을 기반으로 시도
  * 가장 많이 사용되는 알고리즘



### 페이지 교체 알고리즘 (LFU)

* LFU(Least Frequently Used) Page Replacement Algorithm
  * 가장 적게 사용된 페이지를 내림



### 페이지 교체 알고리즘 (NUR)

* NUR(Not Used Recently) Page Replacement Algorithm
  * LRU와 마찬가지로 최근에 사용하지 않은 페이지부터 교체하는 기법
  * 각 페이지마다 참조 비트(R), 수정 비트(M)을 둠
    * (0,0), (0,1), (1,0), (1,1) 순으로 페이지 교체



### 스레싱(Thrashing)

* 반복적으로 페이지 폴트가 발생해서 과도하게 페이지 교체 작업이 일어나 실제로는 아무 일도 하지 못하는 상황
  * 페이지 부재율이 많이 발생하게 되고 CPU 이용율이 급격히 떨어진다.





## 세그멘테이션 기법

* 가상 메모리를 서로 크기가 다른 논리적 단위인 세그먼트(Segment)로 분할
  * 페이징 기법에서는 가상 메모리를 같은 크기의 블록으로 분할
  * 예 : x86 리얼모드
    * CS(Code Segment), DS(Data Segment), SS(Stack Segment), ES(Extra Segment)로 세그먼트를 나누어 메모리 접근
* 세그먼트 가상 주소
  * `v = (s, d)` : `s`는 세그먼트 번호, `d`는 블록 내 세그먼트의 변위

![세그멘테이션](https://2.bp.blogspot.com/-eP3hp95aKQ0/WRcXxlI-ilI/AAAAAAAABRQ/LTsK72INkuEpxpUPLY9Y3bJtjScM1Jc1gCLcB/s1600/segmentation.png)



* 세그먼테이션
  * 가상 메모리를 서로 크기가 다른 논리적 단위인 세그먼트로 분할
  * 각각의 세그먼트들은 연속적인 공간에 저장됨
  * 세그먼트들의 크기가 다르기 때문에 메모리를 페이징 기법처럼 미리 분할해 둘 수 없음
  * 메모리에 적재될 때 빈 공간을 찾아 할당하는 사용자 관점의 가상메모리 관리 기법
  * mapping을 하기 위해 세그먼트 테이블 필요
  * 내부 단편화가 발생하지 않음
  * 물리 메모리가 원하는 연속된 크기의 메모리를 제공해주지 못하는 경우 외부 단편화 발생
* 페이징
  * 물리 메모리를 사용할 때, 페이지를 고정 크기의 프레임 단위로 나눔
  * 연속적인 물리 메모리가 아니더라도 원하는 크기의 프레임을 사용할 수 있도록 함
    * 프레임 : 물리 메모리를 일정한 크기로 나눈 블록
    * 페이지 : 가상 메모리를 일정한 크기로 나눈 블록
  * mapping을 하기 위해 페이징 테이블 필요
  * 연속적이지 않은 공간을 활용할 수 있기 때문에 외부 단편화 해결 가능
  * 페이지 블록만큼 데이터가 딱 맞게 채워져있지 않을 때 공간 낭비가 되므로 내부 단편화가 일어남
* 세그멘테이션과 페이징 모두 하드웨어 지원이 필요하다.





---

## 참고

* [메모리 관리기법, 페이징과 세그멘테이션](https://sycho-lego.tistory.com/10)



