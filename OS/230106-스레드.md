# Thread

## Thread

* Light Weight Process라고도 함
* 프로세스
  * 프로세스 간에는 각 프로세스의 데이터 접근이 불가(IPC를 써야 함)
* 스레드
  * 하나의 프로세스에 여러 개의 스레드 생성 가능
  * 스레드들은 동시에 실행 가능
  * 프로세스 안에 있으므로, 프로세스의 데이터를 모두 접근 가능(IPC 필요 X)
  * 프로세스처럼 완벽한 독립적인 구조가 아니고 스레드들 사이에는 공유하는 요소들이 있다.
  * 공유하는 요소가 있는 관계로 프로세스의 컨텍스트 스위칭에 걸리는 시간이 프로세스보다 짧다.



* 어떤 프로세스 안에 여러 개의 스레드가 있다고 하면, 이 프로세스의 ID(PID)가 CPU를 점유하는 것이 아니라, 이 프로세스 내의 스레드 ID(TID)가 CPU를 점유한다.
* TID 별로 program counter, register set, stack이 달라진다.
* code / data / file 메모리 영역은 한 프로세스 내의 스레드들이 공유한다.

![Thread](https://oopy.lazyrockets.com/api/v2/notion/image?src=https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F646bd376-e96f-42bf-9674-f4619d071da9%2F%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2022-06-29_%EC%98%A4%EC%A0%84_10.57.04.png&blockId=b816eed9-141d-4bf0-b301-63ae68505e20)





## 멀티 Thread

* 멀티 프로세싱 : 여러 프로세스를 여러 개의 CPU로 실행시켜 실행 속도를 높임. (병렬 처리)
* 최근 CPU는 멀티 코어를 가지므로, Thread를 여러 개 만들어 멀티 코어 활용도를 높임
* 소프트웨어 병행 작업 처리를 위해 Multi Thread를 사용함





## Thread 장점

1. CPU 활용도를 높이고 사용자에 대한 응답성 향상
   * 프로세스가 여러 스레드로 분할된 경우 일부 스레드의 처리가 지연되어도, 다른 스레드는 작업을 계속 처리할 수 있음
2. 자원 공유 효율
   * IPC 기법과 같이 프로세스 간 자원 공유를 위해 번거로운 작업이 필요 없음
   * 프로세스 안에 있으므로, 프로세스의 데이터를 모두 접근 가능
3. 작업이 분리되어 코드가 간결
   * 사실 작성하기 나름





## Thread 단점

1. 스레드 중 한 스레드만 문제가 있어도 전체 프로세스가 영향을 받음
2. 스레드를 많이 생성하면 Context Switching이 많이 일어나 성능 저하
   * 예 : 리눅스 OS에서는 Thread를 Process와 같이 다움
     * 스레드를 많이 생성하면 모든 스레드를 스케줄링해야 하므로, Context Switching이 빈번할 수 밖에 없음
3. 자원을 공유하기 때문에 타 스레드 메모리 공간을 덮어쓸 수 있어 안정성에 다소 취약함





## Thread vs Process

* 프로세스는 독립적, 스레드는 프로세스의 서브셋
* 프로세스는 각각 독립적인 자원을 가짐, 스레드는 프로세스 자원 공유
* 프로세스는 자신만의 주소 영역을 가짐, 스레드는 주소 영역 공유
* 프로세스 간에는 IPC 기법으로 통신해야 함, 스레드는 필요 없음





## 동기화

### 동기화 이슈

* 동기화 : 작업들 사이에 실행 시기를 맞추는 것

* 여러 스레드가 동일한 자원(데이터) 접근 시 동기화 이슈 발생

  * 동일 자원을 여러 스레드가 동시 수정 시, 각 스레드 결과에 영향을 줌

* 프로세스 안에 여러 개의 스레드가 존재, 이 스레드들은 프로세스 내부 데이터를 공유함

* 스레드 실행 순서는 정해져 있지 않음. 때문에 실행 순서가 꼬이게 되면 비정상적인 동작을 하게 될 수 있음.

* 혹은 동일 장원을 여러 스레드가 동시 수정하게 될 경우, 각 스레드 결과에 영향을 준다.

  스케줄러 기준 시간과 관련하여 컨텍스트 스위칭이 발생하게 될 경우, 어느 부분에 컨텍스트 스위칭이 발생하는지 알 수 없기 때문에 비정상적인 동작을 하게 될 수 있음

   

---

## 참고

* [쓰레드의 이해](https://80000coding.oopy.io/6cd36f27-32b0-4443-b088-5fa4bca62fac)

* [스레드(Thread) 알아보기](https://yoongrammer.tistory.com/55#%EC%8A%A4%EB%A0%88%EB%93%9C_%EC%9E%A5%EB%8B%A8%EC%A0%90)